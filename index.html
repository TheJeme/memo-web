<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Write memos">
    <meta name="keywords" content="Memo, Notes, Writing">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Memo">
    <meta property="og:description" content="Write memos">
    <meta property="og:image" content="icon.png">
    <meta name="theme-color" content="#22222A">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
      html, body {
        background-color: #22222A;
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        overscroll-behavior: none;
        touch-action: manipulation;
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }

      main {
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
      }

      textarea {
        width: 100%;
        height: 100%;
        margin: 0;
        border: none;
        outline: none;
        resize: none;
        padding: 0;
        box-sizing: border-box;
        background-color: #22222A;
        color: white;
        font-family: monospace;
        font-size: 28px;
        line-height: 1.15;
        text-align: center;
        white-space: pre;
        overflow: auto;
        overscroll-behavior: contain;
        overflow-wrap: normal;
        word-break: normal;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      textarea::-webkit-scrollbar {
        display: none;
      }

      @media (max-width: 700px) {
        textarea {
          line-height: 1.2;
        }
      }

      @media (min-width: 1024px) {
        main {
          padding: 40px;
        }
      }
    </style>
    <title>Memo</title>
</head>
<body>
  <main>
    <textarea spellcheck="false" wrap="off"></textarea>
  </main>
  <script>
const STORAGE_KEY = 'memo';
const editor = document.querySelector('textarea');
let saveTimer = null;
const measureEl = document.createElement('div');
measureEl.style.position = 'absolute';
measureEl.style.visibility = 'hidden';
measureEl.style.pointerEvents = 'none';
measureEl.style.whiteSpace = 'pre';
measureEl.style.left = '-99999px';
measureEl.style.top = '0';
document.body.appendChild(measureEl);

function clamp(value, min, max) {
  return Math.min(max, Math.max(min, value));
}

function getLongestLineLength(text) {
  return (text || '').split('\n').reduce((max, line) => Math.max(max, line.length), 1);
}

function fitsInView() {
  return editor.scrollWidth <= editor.clientWidth + 1 && editor.scrollHeight <= editor.clientHeight + 1;
}

function hasHorizontalOverflow() {
  return editor.scrollWidth > editor.clientWidth + 1;
}

function setWrapMode(enabled) {
  editor.setAttribute('wrap', enabled ? 'soft' : 'off');
  editor.style.whiteSpace = enabled ? 'pre-wrap' : 'pre';
  editor.style.overflowWrap = enabled ? 'anywhere' : 'normal';
  editor.style.wordBreak = enabled ? 'break-word' : 'normal';
}

function fitFontSize() {
  const content = editor.value || '';
  const longestLine = getLongestLineLength(content);
  const minSize = 4;
  const maxSize = 800;
  const emptySize = window.innerWidth < 700 ? 56 : 120;
  const avgMonospaceCharWidthEm = 0.5;
  const targetChars = Math.max(8, longestLine);

  setWrapMode(false);
  editor.style.paddingTop = '0px';
  editor.style.paddingBottom = '0px';

  if (content.length === 0) {
    editor.style.setProperty('font-size', `${emptySize}px`, 'important');
    centerTextVertically();
    return;
  }

  const widthCap = (editor.clientWidth - 2) / (targetChars * avgMonospaceCharWidthEm);
  let low = minSize;
  let high = clamp(widthCap, minSize, maxSize);
  let best = minSize;

  for (let i = 0; i < 14; i += 1) {
    const mid = (low + high) / 2;
    editor.style.setProperty('font-size', `${mid}px`, 'important');
    if (fitsInView()) {
      best = mid;
      low = mid;
    } else {
      high = mid;
    }
  }

  editor.style.setProperty('font-size', `${best}px`, 'important');
  if (best <= minSize + 0.01 && hasHorizontalOverflow()) {
    setWrapMode(true);
  }
  centerTextVertically();
}

function centerTextVertically() {
  editor.style.paddingTop = '0px';
  editor.style.paddingBottom = '0px';
  const styles = getComputedStyle(editor);
  measureEl.style.fontFamily = styles.fontFamily;
  measureEl.style.fontSize = styles.fontSize;
  measureEl.style.lineHeight = styles.lineHeight;
  measureEl.textContent = editor.value.length > 0 ? editor.value : ' ';
  const contentHeight = Math.ceil(measureEl.getBoundingClientRect().height);
  const extraSpace = editor.clientHeight - contentHeight;
  if (extraSpace > 0) {
    const pad = Math.floor(extraSpace / 2);
    editor.style.paddingTop = `${pad}px`;
    editor.style.paddingBottom = `${pad}px`;
  }
}

function persistMemoNow() {
  if (saveTimer) {
    clearTimeout(saveTimer);
    saveTimer = null;
  }
  localStorage.setItem(STORAGE_KEY, editor.value);
}

function queueMemoSave() {
  if (saveTimer) {
    clearTimeout(saveTimer);
  }
  saveTimer = setTimeout(persistMemoNow, 150);
}

editor.value = localStorage.getItem(STORAGE_KEY) ?? '';
fitFontSize();

editor.addEventListener('input', function() {
  fitFontSize();
  queueMemoSave();
});

editor.addEventListener('drop', function(e) {
  e.preventDefault();
  const text = e.dataTransfer?.getData('text/plain') ?? '';
  const start = editor.selectionStart ?? editor.value.length;
  const end = editor.selectionEnd ?? editor.value.length;
  editor.value = editor.value.slice(0, start) + text + editor.value.slice(end);
  const caret = start + text.length;
  editor.selectionStart = caret;
  editor.selectionEnd = caret;
  fitFontSize();
  queueMemoSave();
});

window.addEventListener('resize', fitFontSize);
window.addEventListener('pagehide', persistMemoNow);

document.addEventListener('visibilitychange', function() {
  if (document.visibilityState === 'hidden') {
    persistMemoNow();
  }
});

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations().then(function(registrations) {
    registrations.forEach(function(registration) {
      registration.unregister();
    });
  });
}

document.addEventListener('gesturestart', function(e) {
  e.preventDefault();
}, { passive: false });

document.addEventListener('gesturechange', function(e) {
  e.preventDefault();
}, { passive: false });

document.addEventListener('gestureend', function(e) {
  e.preventDefault();
}, { passive: false });

document.addEventListener('touchmove', function(e) {
  if (e.touches && e.touches.length > 1) {
    e.preventDefault();
  }
}, { passive: false });

let lastTouchEnd = 0;
document.addEventListener('touchend', function(e) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) {
    e.preventDefault();
  }
  lastTouchEnd = now;
}, { passive: false });
  </script>
</body>
</html>
